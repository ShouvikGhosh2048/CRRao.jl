turnout = dataset("Zelig", "turnout")[1:100,:] # Take a subset of rows to reduce input size

frequentist_tests = [
    (
        Logit(),
        [[-3.115250226343716, 0.02678824815513655, -0.316228875672267, 0.3912504801394897, 0.18558746354177186], [1.6619797529149387, 0.014557716632590404, 0.769732115940088, 0.1519012178319058, 0.10029080592418851], [-1.87442128634834, 1.8401407879561016, -0.410829779768317, 2.5756902131782002, 1.8504932912999075], [0.06087238185014436, 0.06574757040517729, 0.6811973551391216, 0.010004023142671487, 0.06424248407476521], [-6.37267068509178, -0.0017443521418804078, -1.8248761006586514, 0.09352956398118034, -0.01097890405013427], [0.1421702324043479, 0.05532084845215351, 1.1924183493141172, 0.688971396297799, 0.38215383113367796]],
        104.19008339655036,
        117.21593432649082
    ), 
    (
        Probit(),
        [[-1.6167063621141218, 0.015177850402200318, -0.21045943737898234, 0.19497439255911475, 0.10264582322592367], [0.9460915423616147, 0.00839129335625783, 0.45317620199896247, 0.07931756483792651, 0.05727454122153256], [-1.708826566696212, 1.808761743609094, -0.4644097294841272, 2.458148998365186, 1.7921718976132734], [0.08748308009877574, 0.07048802604621927, 0.6423542206618378, 0.013965521927629131, 0.07310543476230877], [-3.471011711220841, -0.0012687823597752924, -1.098668471947599, 0.039514822135357924, -0.009610214799335076], [0.2375989869925974, 0.03162448316417593, 0.6777495971896342, 0.35043396298287155, 0.2149018612511824]],
        105.14224424081024,
        118.1680951707507
    ), 
    (
        Cloglog(),
        [[-1.5345202042517703, 0.013020060771373045, -0.23940539309325237, 0.1446143261603412, 0.0866855330976219], [0.8764100511922919, 0.007855862501700618, 0.4169595652824007, 0.06365100617163288, 0.052198451350105084], [-1.7509157981063403, 1.6573687190368331, -0.5741693272610416, 2.27198806206446, 1.6606916652795944], [0.0799604151009633, 0.09744495166188041, 0.5658532233276155, 0.02308723137940732, 0.09677538819688797], [-3.2522523402775705, -0.0023771467994589245, -1.0566311240562367, 0.01986064648420381, -0.015621551597350403], [0.18321193177402995, 0.028417268342205017, 0.577820337869732, 0.2693680058364786, 0.18899261779259421]],
        106.54303535653858,
        119.56888628647904
    ), 
    (
        Cauchit(),
        [[-5.0280984580645205, 0.030307086556783353, -0.10675070488025179, 0.725647410414383, 0.2697892264990478], [2.332541076397088, 0.01825745967005376, 0.8237759901457558, 0.28375814029188445, 0.13210133533076798], [-2.1556312593778926, 1.6599837603088685, -0.12958705540976465, 2.557274338166843, 2.0422899270739667], [0.03111246965592515, 0.09691771956059198, 0.8968931451701165, 0.010549598151516338, 0.04112278068944088], [-9.599794960263113, -0.005476876845714622, -1.7213219768947585, 0.1694916751222244, 0.010875366941093478], [-0.45640195586592824, 0.06609104995928133, 1.5078205671342548, 1.2818031457065415, 0.5287030860570021]],
        100.94153874293306,
        113.96738967287352
    )
]

for (link,test_cols,test_aic,test_bic) in frequentist_tests
    CRRao.set_rng(StableRNG(123))
    model = @fitmodel((Vote ~ Age + Race + Income + Educate), turnout, LogisticRegression(), link)
    
    @test coeftable(model).cols ≈ test_cols
    @test aic(model) ≈ test_aic
    @test bic(model) ≈ test_bic
end

bayesian_tests = [
    (
        Prior_Ridge(),
        Logit(),
        (parameters = [:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], mean = [0.18073317411373513, 0.006286100400741033, -0.060723914467321345, 0.18412001659897395, 0.035571257666335454], std = [0.15402639090402814, 0.00972063394777559, 0.21788775686726397, 0.11722882674326475, 0.04643434178280452], naive_se = [0.0015402639090402815, 9.72063394777559e-5, 0.00217887756867264, 0.0011722882674326475, 0.00046434341782804526], mcse = [0.003121928362446935, 0.0001234659304824884, 0.004505913201410779, 0.002139407932025963, 0.000640552701494998], ess = [2374.4930282943346, 4681.975635639626, 2622.4660119286573, 3123.2783101804775, 4599.926470699543], rhat = [0.99992257809843, 1.0000184088670079, 0.999996882451382, 1.0000159754781592, 1.0001072001805784]),
        ([:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.0391557960216471, -0.01254032225086455, -0.6093731838972523, 0.0011521240540788627, -0.05864618725965086], [0.0888809715289676, -0.00024106439090489367, -0.134393588908006, 0.09532088731344726, 0.005856794666650417], [0.14005056149268968, 0.00618711654997056, -0.02654428756463982, 0.16987753513939458, 0.036081469043317216], [0.223989183014338, 0.012754566502714273, 0.05390124545816355, 0.2590290831257101, 0.06569234382504253], [0.5639417920422437, 0.02548573711129247, 0.2868524622341777, 0.4415863620222287, 0.1266266991140356])
    ),
    (
        Prior_Ridge(),
        Probit(),
        (parameters = [:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], mean = [0.11884492621898701, 0.003743178749682603, -0.03802570812714874, 0.11329969691747506, 0.02104657104373814], std = [0.08955567347631374, 0.005684913914997188, 0.1358575676810259, 0.0636653096521502, 0.02858745552056903], naive_se = [0.0008955567347631374, 5.6849139149971884e-5, 0.001358575676810259, 0.000636653096521502, 0.0002858745552056903], mcse = [0.001719718196159385, 8.841852351061175e-5, 0.002355865133384414, 0.0009684655879254097, 0.00038919915103431826], ess = [2625.5463394444328, 4894.1379062239685, 3513.6297604444067, 3833.801767851189, 4447.356500101401], rhat = [0.9999463465664608, 1.0000306948085205, 1.0000487895138899, 0.999927537859179, 0.999942899802118]),
        ([:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.032224579673185906, -0.007445757684769268, -0.3776369287666729, 0.006400518070012658, -0.03663173881783453], [0.06422202123996279, -7.72832907583204e-5, -0.08884444128618464, 0.06659243768810079, 0.0022816778737165134], [0.09450570556580506, 0.0037481127938673005, -0.02012315080756645, 0.10796234559954115, 0.021694073005222914], [0.14338279328269682, 0.007564174657145074, 0.03304720036035912, 0.15358227318013185, 0.040343235745662766], [0.3558916189609701, 0.015033172058051747, 0.18467581804884173, 0.2531681336812343, 0.07573580384578589])
    ),
    (
        Prior_Ridge(),
        Cloglog(),
        (parameters = [:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], mean = [0.10246317700977038, 0.0012381930796966521, -0.03768664985046625, 0.08850193307687533, 0.006689312021474056], std = [0.08440536660816515, 0.005057124654460647, 0.11523678624570884, 0.05281662458716859, 0.02539566520467618], naive_se = [0.0008440536660816516, 5.057124654460647e-5, 0.0011523678624570884, 0.0005281662458716859, 0.0002539566520467618], mcse = [0.0018156820168166634, 7.75458993473079e-5, 0.002208358972757066, 0.0009281463792560395, 0.0004475251255097314], ess = [2400.9930806055336, 4778.885163778122, 2795.9578377333587, 3417.737478176756, 3735.7636914908676], rhat = [0.9999146118981819, 0.9999247617977749, 0.999980162228215, 0.9999826471968486, 1.0000009564966468]),
        ([:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.02594948545060121, -0.009032919556342446, -0.33606531263106093, 0.0006123119166942536, -0.046005528354544786], [0.05384653878556582, -0.0020894021766894966, -0.08140100901101345, 0.049899577564495326, -0.009744873306603745], [0.07977055266578359, 0.0013152248786172437, -0.019691898846725557, 0.08393397508311681, 0.007582645107533061], [0.1232768646137121, 0.004655407010466173, 0.025711914183668763, 0.12276959979851226, 0.02420966146664147], [0.31319770745757264, 0.010873551413510783, 0.14819470594289616, 0.20201112540390134, 0.05449019349564022])
    ),
    (
        Prior_Laplace(),
        Probit(),
        (parameters = [:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], mean = [0.11666509578782588, 0.0037955031732192033, -0.05113150606463816, 0.12592197647606912, 0.018270128932988877], std = [0.09951993412566987, 0.005598533629471494, 0.165612011123652, 0.06719504967437048, 0.028258141733481956], naive_se = [0.0009951993412566987, 5.598533629471494e-5, 0.00165612011123652, 0.0006719504967437049, 0.00028258141733481955], mcse = [0.0016958487777603102, 8.426561476500058e-5, 0.0032355516827288766, 0.0010818646933695268, 0.00045505741442861234], ess = [3424.4060404777633, 4545.459615787451, 2571.0812862236085, 3943.2060836307633, 3747.326939527853], rhat = [0.9999002024386763, 0.9999454332282867, 0.9999000946875711, 0.9999053094430989, 0.9999190237081718]),
        ([:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.02939511896567749, -0.007154950282220606, -0.4820486027634976, 0.007151433030822042, -0.03673772591433043], [0.05878020000578727, -3.3363120468901143e-6, -0.09708842878131196, 0.07728156086260235, -0.0006723197680841428], [0.08873943965768993, 0.0037831777091154855, -0.017079879613095778, 0.12286954721495015, 0.01731800940047424], [0.14005667655020157, 0.007538107657884537, 0.02871625031605868, 0.16906628359428708, 0.03714380402674099], [0.37506101144682985, 0.014812135882447057, 0.2000337210628823, 0.2679967362873262, 0.0740054351095892])
    ),
    (
        Prior_Laplace(),
        Cloglog(),
        (parameters = [:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], mean = [0.10122850352398577, 0.001357526363804852, -0.05043976799577368, 0.0959580618543348, 0.00481438949895729], std = [0.08678947120436599, 0.004798026431102891, 0.14133546777959904, 0.053508001404016195, 0.024646920816575997], naive_se = [0.00086789471204366, 4.798026431102891e-5, 0.0014133546777959905, 0.000535080014040162, 0.00024646920816575994], mcse = [0.0014638667128436347, 7.044630498310735e-5, 0.0023447399873375123, 0.0008033970369758344, 0.00032817890048596047], ess = [3110.3372750043727, 4734.835626430306, 3631.289129090927, 3532.410726672335, 3924.803568097954], rhat = [0.9999897234961698, 1.0004585826333359, 0.9999000030491105, 1.0001867959013824, 1.0006722869565672]),
        ([:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.02572239514722463, -0.008257668475738467, -0.4492690281508872, 0.0006789267860291816, -0.04534212457672533], [0.05050403849285442, -0.0017907409371694114, -0.09121797490891873, 0.0576273873888277, -0.010630914614789221], [0.07614119979808881, 0.0014122424425981465, -0.01953605687720073, 0.09409263747089644, 0.004642530489805969], [0.11990630207078448, 0.004593271361465657, 0.020640324190038917, 0.13021976069183733, 0.020678626159535186], [0.33558685542420735, 0.010521245427259572, 0.16374168560196647, 0.20831389112926227, 0.052644980854341335])
    ),
    (
        Prior_Cauchy(),
        Probit(),
        (parameters = [:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], mean = [0.07303502639990667, 0.004237215089120808, -0.04923406758365931, 0.12579951993954375, 0.015721588101636867], std = [0.0919132505599472, 0.0053271615434058745, 0.18290117890119154, 0.07007571693990368, 0.026697956111001314], naive_se = [0.0009191325055994719, 5.327161543405875e-5, 0.0018290117890119152, 0.0007007571693990369, 0.00026697956111001314], mcse = [0.0016883186613163024, 9.117966164074205e-5, 0.0042961403772076535, 0.0014520349192871766, 0.0005331483724401799], ess = [2907.9111555257145, 3206.210159664114, 1827.6657450232394, 2394.1152795079147, 2387.7258591895743], rhat = [1.0006718922197126, 1.000421859325476, 1.0017877663834345, 0.9999516399557881, 1.0000277137432994]),
        ([:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.0061103307058732225, -0.006306683315625614, -0.5612447593317031, 0.0008868816552977984, -0.03421968992447279], [0.021265336021366946, 0.0007547889466691547, -0.06842808312059037, 0.0763861407715781, -0.001550942634797354], [0.044362161451251346, 0.004158874761744155, -0.007153168998604863, 0.12427188840540263, 0.0130860299125117], [0.08865870456461353, 0.007723597654261207, 0.019893070335947154, 0.17373674278225373, 0.0318340507953479], [0.31676253041020475, 0.01489638658676204, 0.21040247681723184, 0.2683730233974889, 0.07142796831415721])
    ),
    (
        Prior_Cauchy(),
        Cloglog(),
        (parameters = [:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], mean = [0.0527475571973838, 0.0016969652216858701, -0.04150423444307322, 0.08496611053595839, 0.00543365118438976], std = [0.07286993234646631, 0.004502743263957936, 0.1434278617639147, 0.057363761401730086, 0.022046796898089898], naive_se = [0.0007286993234646631, 4.502743263957936e-5, 0.0014342786176391468, 0.0005736376140173009, 0.00022046796898089895], mcse = [0.0014571007427809193, 8.482891933258401e-5, 0.003108369484636905, 0.0016720925214508753, 0.0004590176033467877], ess = [2441.768008888466, 2289.580257010328, 1894.5775458734938, 1065.1961494977218, 3024.8019109041525], rhat = [1.000257881401998, 1.001158040094372, 1.0000924830163127, 1.0008613507519242, 1.0003217152269566]),
        ([:λ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.0033870870350765103, -0.007384905645310517, -0.4715176570952705, -0.004446917644389378, -0.04019710439352393], [0.012928514514815276, -0.0011967134082898332, -0.050111910979519704, 0.040135424813344645, -0.006408299278162361], [0.028660049921850242, 0.0017138166195864606, -0.005003891310132087, 0.0827385253539159, 0.004344780271756718], [0.06318169553804347, 0.004792782903437325, 0.013102483590738952, 0.12483273626104217, 0.01794571155637737], [0.24803683756456715, 0.01043445707685056, 0.1502645629310197, 0.20281468902041666, 0.05113813425245751])
    ),
    (
        Prior_TDist(),
        Probit(),
        (parameters = [:λ, :ν, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], mean = [0.3490399808835042, 17.392861817444746, 0.004510147713851328, -0.2138163547844494, 0.16696124619947214, 0.01792556836846573], std = [0.2082061533711701, 147.1585162491969, 0.006150252023631501, 0.31464125064885773, 0.06946151106976285, 0.03366866112105866], naive_se = [0.002082061533711701, 1.4715851624919691, 6.150252023631501e-5, 0.0031464125064885775, 0.0006946151106976286, 0.0003366866112105866], mcse = [0.0026886463785343725, 2.3371178895650626, 6.876560923432344e-5, 0.003831794089595179, 0.0008377524453507913, 0.00044070014419614095], ess = [5481.19245128045, 3740.1531973174465, 6737.107963272813, 4876.793586553652, 7229.635346027233, 5600.782195028789], rhat = [0.9999316436564322, 0.9999504578607115, 0.999911022679083, 0.9999314444255094, 1.0000308092457313, 0.9999029137421541]),
        ([:λ, :ν, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.129583850301315, 0.4942156129691201, -0.0075387466889747685, -0.932099025002865, 0.03838934962489522, -0.0479203175725355], [0.21670347675163612, 1.3820306845287833, 0.0003712219959571628, -0.3932721104180704, 0.11911071525267727, -0.00488395732731236], [0.2946530331247196, 2.845838070938792, 0.004478067788329808, -0.16749101231113692, 0.16375432758504505, 0.01764755975903226], [0.416033263515337, 7.015878840404998, 0.008673718568510944, -0.000984672977289876, 0.21194085836544288, 0.040616160483212316], [0.8857853150039567, 86.85906818671305, 0.016698219917082195, 0.30226990146692917, 0.31294201031725966, 0.0847616437739103])
    ),
    (
        Prior_TDist(),
        Cloglog(),
        (parameters = [:λ, :ν, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], mean = [0.336425817899214, 53.78313486536571, 0.002414539029646664, -0.2217591692142837, 0.13316569521173252, 0.0029903694769095324], std = [0.19249908982486685, 1797.9525331993766, 0.005643209977013736, 0.2832005758563193, 0.0554029505686292, 0.03018623708532351], naive_se = [0.0019249908982486685, 17.979525331993766, 5.643209977013737e-5, 0.002832005758563193, 0.000554029505686292, 0.00030186237085323513], mcse = [0.0023604061138473055, 33.28163161336366, 6.016143160412146e-5, 0.00344163159331998, 0.0006303340810789084, 0.0003827098608860028], ess = [6149.3367036518, 2973.012914879739, 7196.061284993717, 5689.221733160488, 7407.469727067034, 6027.223146988214], rhat = [1.000345240316717, 1.000399465535321, 0.9999130571161097, 0.9999356920846298, 1.0003806565292876, 0.9999929531331432]),
        ([:λ, :ν, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.1262110053081064, 0.4750849567086566, -0.008838850384126943, -0.8618604312697293, 0.028967552199725737, -0.05765115132905696], [0.20977714973016107, 1.389369419693856, -0.0013394866356396988, -0.3900046924559044, 0.09478210131157735, -0.01697359591014218], [0.28877869760689395, 2.8523205074515814, 0.002452215883295611, -0.18734703453748205, 0.13195980978720942, 0.003258691401501784], [0.4037856202354172, 6.671795688139387, 0.006224831485396117, -0.02772354625694781, 0.16935005168314643, 0.023544355268136252], [0.8420033542118925, 74.08944028430506, 0.013325216333915037, 0.25439488593326587, 0.2472997944880542, 0.06182924667937186])
    )
]

for (prior, link, test_summaries, test_quantiles) in bayesian_tests
    CRRao.set_rng(StableRNG(123))
    model = @fitmodel((Vote ~ Age + Race + Income + Educate), turnout, LogisticRegression(), link, prior)

    #Split summaries and quantiles into symbols and numbers for testing equality/approximate equality. 
    model_summaries, model_quantiles = describe(model.chain)
    (model_summaries_symbols, model_summaries_nums...) = model_summaries.nt
    (model_quantiles_symbols, model_quantiles_nums...) = model_quantiles.nt
    (test_summaries_symbols, test_summaries_nums...) = test_summaries
    (test_quantiles_symbols, test_quantiles_nums...) = test_quantiles

    @test model_summaries_symbols == test_summaries_symbols
    for i in 1:length(test_summaries_nums)
        @test model_summaries_nums[i] ≈ test_summaries_nums[i]
    end
    @test model_quantiles_symbols == test_quantiles_symbols
    for i in 1:length(test_quantiles_nums)
        @test model_quantiles_nums[i] ≈ test_quantiles_nums[i]
    end
end